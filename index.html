<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV ao Vivo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Seção 1: Header -->
    <header>
        <h1>TV ao Vivo</h1>
    </header>

    <!-- Seção 2: Menu de Categorias -->
    <nav class="menu-categorias">
        <ul>
            <li><a href="#">Categoria 1</a></li>
            <li><a href="#">Categoria 2</a></li>
            <li><a href="#">Categoria 3</a></li>
        </ul>
    </nav>

    <!-- Seção 3: Player de Vídeo -->
    <section class="player-section">
        <div class="player-wrapper">
            <!-- Seta de navegação esquerda -->
            <div class="nav-arrow left-arrow" onclick="trocarCanal(-1)">&#10094;</div>

            <!-- Player de Vídeo -->
            <video id="videoPlayer" controls width="800" height="450" muted autoplay>
                Seu navegador não suporta a tag de vídeo.
            </video>

            <!-- Seta de navegação direita -->
            <div class="nav-arrow right-arrow" onclick="trocarCanal(1)">&#10095;</div>
        </div>
    </section>

    <!-- Seção 4: Grade de Canais -->
    <section class="grade-canais">
        <div class="canais-container" id="canais-container">
            <!-- Canais serão carregados dinamicamente aqui -->
        </div>
    </section>

    <!-- Seção 5: Footer -->
    <footer>
        <p>&copy; 2023 TV ao Vivo. Todos os direitos reservados.</p>
    </footer>

    <!-- Inclua a biblioteca hls.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Carregar canais do arquivo JSON
        fetch('canais.json')
            .then(response => response.json())
            .then(canais => {
                const container = document.getElementById('canais-container');
                canais.forEach(canal => {
                    const div = document.createElement('div');
                    div.className = 'canal';
                    div.setAttribute('data-src', canal.stream);
                    div.innerHTML = `
                        <img src="${canal.logo}" alt="${canal.nome}">
                        <p class="nome-canal">${canal.nome}</p>
                    `;
                    container.appendChild(div);
                });
            });

        // Lógica do player com suporte a HLS
        const player = document.getElementById('videoPlayer');
        let hls; // Variável para instância do HLS
        let canalAtual = 0;

        function carregarCanal(index) {
            const canais = document.querySelectorAll('.canal');
            if (index < 0) index = canais.length - 1;
            if (index >= canais.length) index = 0;

            const src = canais[index].getAttribute('data-src');

            if (Hls.isSupported()) {
                // Se o navegador suportar HLS, use hls.js
                if (hls) {
                    hls.destroy(); // Destrua a instância anterior do HLS
                }
                hls = new Hls();
                hls.loadSource(src);
                hls.attachMedia(player);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    player.play();
                });
            } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                // Navegadores com suporte nativo a HLS (Safari)
                player.src = src;
                player.play();
            } else {
                alert("Seu navegador não suporta a reprodução deste vídeo.");
            }

            canalAtual = index;
        }

        window.trocarCanal = function(direcao) {
            carregarCanal(canalAtual + direcao);
        };

        document.querySelectorAll('.canal').forEach((canal, index) => {
            canal.addEventListener('click', () => {
                carregarCanal(index);
            });
        });

        // Iniciar com o primeiro canal
        carregarCanal(canalAtual);
    </script>
</body>
</html>
