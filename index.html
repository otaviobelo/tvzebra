<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player de Vídeo com Carregamento de Lista M3U</title>
    <!-- Inclua o CSS do Video.js -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .input-container {
            margin-top: 20px;
        }
        input[type="file"], input[type="url"] {
            margin-bottom: 10px;
            width: 300px;
            padding: 8px;
            font-size: 16px;
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
        }
        #url-list {
            margin-top: 20px;
        }
        #url-list div {
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f0f0f0;
            cursor: pointer;
        }
        #url-list div:hover {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <h1>Player de Vídeo com Carregamento de Lista M3U</h1>

    <!-- Player de Vídeo -->
    <video
        id="my-video"
        class="video-js vjs-default-skin"
        controls
        autoplay
        muted
        preload="auto"
        width="640"
        height="360"
        data-setup="{}"
    >
        <source src="" type="application/x-mpegURL" />
        <p class="vjs-no-js">
            Para visualizar este vídeo, habilite o JavaScript ou considere atualizar para um navegador que suporte HTML5.
        </p>
    </video>

    <!-- Campo para carregar arquivo M3U -->
    <div class="input-container">
        <input type="file" id="m3u-file" accept=".m3u" />
        <button onclick="processM3UFile()">Processar Arquivo M3U</button>
    </div>

    <!-- Campo para informar a URL do arquivo M3U -->
    <div class="input-container">
        <input type="url" id="m3u-url" placeholder="Informe a URL do arquivo M3U" />
        <button onclick="processM3UFromURL()">Processar URL do M3U</button>
    </div>

    <!-- Lista de URLs extraídas -->
    <div id="url-list">
        <h3>URLs Extraídas:</h3>
    </div>

    <!-- Inclua o JavaScript do Video.js -->
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script>
        // Função para processar o arquivo M3U carregado
        function processM3UFile() {
            const fileInput = document.getElementById('m3u-file');
            const file = fileInput.files[0];

            if (!file) {
                alert("Por favor, selecione um arquivo M3U.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const urls = extractURLsFromM3U(content); // Extrai as URLs do conteúdo do arquivo
                saveURLsToLocalStorage(urls); // Salva as URLs no localStorage
                displayURLs(urls); // Exibe as URLs na página
            };
            reader.readAsText(file);
        }

        // Função para processar o arquivo M3U a partir de uma URL
        function processM3UFromURL() {
            const urlInput = document.getElementById('m3u-url');
            const url = urlInput.value.trim();

            if (!url) {
                alert("Por favor, informe a URL do arquivo M3U.");
                return;
            }

            // Adiciona um proxy CORS para evitar problemas de CORS
            const proxyUrl = `https://cors-anywhere.herokuapp.com/${url}`;

            fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erro ao carregar o arquivo M3U.");
                    }
                    return response.text();
                })
                .then(content => {
                    const urls = extractURLsFromM3U(content); // Extrai as URLs do conteúdo do arquivo
                    saveURLsToLocalStorage(urls); // Salva as URLs no localStorage
                    displayURLs(urls); // Exibe as URLs na página
                })
                .catch(error => {
                    console.error("Erro:", error);
                    alert("Erro ao carregar o arquivo M3U. Verifique a URL e tente novamente.");
                });
        }

        // Função para extrair URLs de um arquivo M3U
        function extractURLsFromM3U(content) {
            const lines = content.split('\n');
            const urls = [];

            for (let line of lines) {
                // Remove espaços em branco no início e no fim da linha
                line = line.trim();

                // Verifica se a linha é uma URL válida
                if (line.startsWith('http')) {
                    urls.push(line);
                }
            }

            return urls;
        }

        // Função para salvar URLs no localStorage
        function saveURLsToLocalStorage(urls) {
            localStorage.setItem('savedURLs', JSON.stringify(urls));
        }

        // Função para carregar URLs do localStorage
        function loadURLsFromLocalStorage() {
            const savedURLs = localStorage.getItem('savedURLs');
            return savedURLs ? JSON.parse(savedURLs) : [];
        }

        // Função para exibir as URLs na página
        function displayURLs(urls) {
            const urlList = document.getElementById('url-list');
            urlList.innerHTML = '<h3>URLs Extraídas:</h3>';

            urls.forEach((url, index) => {
                const urlDiv = document.createElement('div');
                urlDiv.textContent = url;
                urlDiv.onclick = () => playURL(url); // Reproduz a URL ao clicar
                urlList.appendChild(urlDiv);
            });
        }

        // Função para reproduzir uma URL no player
        function playURL(url) {
            const player = videojs('my-video');
            player.src({ type: 'application/x-mpegURL', src: url });
            player.load();
            player.play();
        }

        // Carrega as URLs salvas ao carregar a página
        window.onload = function () {
            const savedURLs = loadURLsFromLocalStorage();
            displayURLs(savedURLs);
        };
    </script>
</body>
</html>
